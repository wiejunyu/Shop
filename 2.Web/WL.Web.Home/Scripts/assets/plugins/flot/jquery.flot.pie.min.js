(function(n){function u(u){function w(i){l||(l=!0,a=i.getCanvas(),h=n(a).parent(),t=i.getOptions(),i.setData(b(i.getData())))}function b(i){for(var r,f=0,e=0,o=0,s=t.series.pie.combine.color,h=[],u=0;u<i.length;++u)r=i[u].data,n.isArray(r)&&r.length==1&&(r=r[0]),n.isArray(r)?r[1]=!isNaN(parseFloat(r[1]))&&isFinite(r[1])?+r[1]:0:r=!isNaN(parseFloat(r))&&isFinite(r)?[1,+r]:[1,0],i[u].data=[r];for(u=0;u<i.length;++u)f+=i[u].data[0][1];for(u=0;u<i.length;++u)r=i[u].data[0][1],r/f<=t.series.pie.combine.threshold&&(e+=r,o++,s||(s=i[u].color));for(u=0;u<i.length;++u)r=i[u].data[0][1],(o<2||r/f>t.series.pie.combine.threshold)&&h.push({data:[[1,r]],color:i[u].color,label:i[u].label,angle:r*Math.PI*2/f,percent:r/(f/100)});return o>1&&h.push({data:[[1,e]],color:s,label:t.series.pie.combine.label,angle:e*Math.PI*2/f,percent:e/(f/100)}),h}function k(u,s){function k(){f.clearRect(0,0,y,p);h.children().filter(".pieLabel, .pieLabelBackground").remove()}function d(){var r=t.series.pie.shadow.left,u=t.series.pie.shadow.top,s=10,h=t.series.pie.shadow.alpha,n=t.series.pie.radius>1?t.series.pie.radius:o*t.series.pie.radius,i;if(!(n>=y/2-r)&&!(n*t.series.pie.tilt>=p/2-u)&&!(n<=s)){for(f.save(),f.translate(r,u),f.globalAlpha=h,f.fillStyle="#000",f.translate(e,c),f.scale(1,t.series.pie.tilt),i=1;i<=s;i++)f.beginPath(),f.arc(0,0,n,0,Math.PI*2,!1),f.fill(),n-=i;f.restore()}}function g(){function l(n,t,i){n<=0||isNaN(n)||(i?f.fillStyle=t:(f.strokeStyle=t,f.lineJoin="round"),f.beginPath(),Math.abs(n-Math.PI*2)>1e-9&&f.moveTo(0,0),f.arc(0,0,s,r,r+n/2,!1),f.arc(0,0,s,r+n/2,r+n,!1),f.closePath(),r+=n,i?f.fill():f.stroke())}function w(){function s(i,r,u){var w,s,b,v,nt;if(i.data[0][1]==0)return!0;w=t.legend.labelFormatter;b=t.series.pie.label.formatter;s=w?w(i.label,i):i.label;b&&(s=b(s,i));var k=(r+i.angle+r)/2,d=e+Math.round(Math.cos(k)*f),g=c+Math.round(Math.sin(k)*f)*t.series.pie.tilt,tt="<span class='pieLabel' id='pieLabel"+u+"' style='position:absolute;top:"+g+"px;left:"+d+"px;'>"+s+"<\/span>";h.append(tt);var o=h.children("#pieLabel"+u),l=g-o.height()/2,a=d-o.width()/2;return(o.css("top",l),o.css("left",a),0-l>0||0-a>0||p-(l+o.height())<0||y-(a+o.width())<0)?!1:(t.series.pie.label.background.opacity!=0&&(v=t.series.pie.label.background.color,v==null&&(v=i.color),nt="top:"+l+"px;left:"+a+"px;",n("<div class='pieLabelBackground' style='position:absolute;width:"+o.width()+"px;height:"+o.height()+"px;"+nt+"background-color:"+v+";'><\/div>").css("opacity",t.series.pie.label.background.opacity).insertBefore(o)),!0)}for(var r=u,f=t.series.pie.label.radius>1?t.series.pie.label.radius:o*t.series.pie.label.radius,i=0;i<a.length;++i){if(a[i].percent>=t.series.pie.label.threshold*100&&!s(a[i],r,i))return!1;r+=a[i].angle}return!0}var u=Math.PI*t.series.pie.startAngle,s=t.series.pie.radius>1?t.series.pie.radius:o*t.series.pie.radius,r,i;for(f.save(),f.translate(e,c),f.scale(1,t.series.pie.tilt),f.save(),r=u,i=0;i<a.length;++i)a[i].startAngle=r,l(a[i].angle,a[i].color,!0);if(f.restore(),t.series.pie.stroke.width>0){for(f.save(),f.lineWidth=t.series.pie.stroke.width,r=u,i=0;i<a.length;++i)l(a[i].angle,t.series.pie.stroke.color,!1);f.restore()}return v(f),f.restore(),t.series.pie.label.show?w():!0}var a,w;if(h){var y=u.getPlaceholder().width(),p=u.getPlaceholder().height(),b=h.children().filter(".legend").children().width()||0;f=s;l=!1;o=Math.min(y,p/t.series.pie.tilt)/2;c=p/2+t.series.pie.offset.top;e=y/2;t.series.pie.offset.left=="auto"?t.legend.position.match("w")?e+=b/2:e-=b/2:e+=t.series.pie.offset.left;e<o?e=o:e>y-o&&(e=y-o);a=u.getData();w=0;do w>0&&(o*=r),w+=1,k(),t.series.pie.tilt<=.8&&d();while(!g()&&w<i);w>=i&&(k(),h.prepend("<div class='error'>Could not draw pie with labels contained inside canvas<\/div>"));u.setSeries&&u.insertLegend&&(u.setSeries(a),u.insertLegend())}}function v(n){if(t.series.pie.innerRadius>0){n.save();var i=t.series.pie.innerRadius>1?t.series.pie.innerRadius:o*t.series.pie.innerRadius;n.globalCompositeOperation="destination-out";n.beginPath();n.fillStyle=t.series.pie.stroke.color;n.arc(0,0,i,0,Math.PI*2,!1);n.fill();n.closePath();n.restore();n.save();n.beginPath();n.strokeStyle=t.series.pie.stroke.color;n.arc(0,0,i,0,Math.PI*2,!1);n.stroke();n.closePath();n.restore()}}function d(n,t){for(var u=!1,i=-1,f=n.length,r=f-1;++i<f;r=i)(n[i][1]<=t[1]&&t[1]<n[r][1]||n[r][1]<=t[1]&&t[1]<n[i][1])&&t[0]<(n[r][0]-n[i][0])*(t[1]-n[i][1])/(n[r][1]-n[i][1])+n[i][0]&&(u=!u);return u}function g(n,t){for(var i,l=u.getData(),h=u.getOptions(),r=h.series.pie.radius>1?h.series.pie.radius:o*h.series.pie.radius,a,v,s=0;s<l.length;++s)if(i=l[s],i.pie.show){if(f.save(),f.beginPath(),f.moveTo(0,0),f.arc(0,0,r,i.startAngle,i.startAngle+i.angle/2,!1),f.arc(0,0,r,i.startAngle+i.angle/2,i.startAngle+i.angle,!1),f.closePath(),a=n-e,v=t-c,f.isPointInPath){if(f.isPointInPath(n-e,t-c))return f.restore(),{datapoint:[i.percent,i.data],dataIndex:0,series:i,seriesIndex:s}}else{var y=r*Math.cos(i.startAngle),p=r*Math.sin(i.startAngle),w=r*Math.cos(i.startAngle+i.angle/4),b=r*Math.sin(i.startAngle+i.angle/4),k=r*Math.cos(i.startAngle+i.angle/2),g=r*Math.sin(i.startAngle+i.angle/2),nt=r*Math.cos(i.startAngle+i.angle/1.5),tt=r*Math.sin(i.startAngle+i.angle/1.5),it=r*Math.cos(i.startAngle+i.angle),rt=r*Math.sin(i.startAngle+i.angle),ut=[[0,0],[y,p],[w,b],[k,g],[nt,tt],[it,rt]],ft=[a,v];if(d(ut,ft))return f.restore(),{datapoint:[i.percent,i.data],dataIndex:0,series:i,seriesIndex:s}}f.restore()}return null}function nt(n){y("plothover",n)}function tt(n){y("plotclick",n)}function y(n,i){var o=u.offset(),l=parseInt(i.pageX-o.left),a=parseInt(i.pageY-o.top),r=g(l,a),f,e,c;if(t.grid.autoHighlight)for(f=0;f<s.length;++f)e=s[f],e.auto!=n||r&&e.series==r.series||rt(e.series);r&&it(r.series,n);c={pageX:i.pageX,pageY:i.pageY};h.trigger(n,[c,r])}function it(n,t){var i=p(n);i==-1?(s.push({series:n,auto:t}),u.triggerRedrawOverlay()):t||(s[i].auto=!1)}function rt(n){n==null&&(s=[],u.triggerRedrawOverlay());var t=p(n);t!=-1&&(s.splice(t,1),u.triggerRedrawOverlay())}function p(n){for(var i,t=0;t<s.length;++t)if(i=s[t],i.series==n)return t;return-1}function ut(n,t){function f(n){n.angle<=0||isNaN(n.angle)||(t.fillStyle="rgba(255, 255, 255, "+i.series.pie.highlight.opacity+")",t.beginPath(),Math.abs(n.angle-Math.PI*2)>1e-9&&t.moveTo(0,0),t.arc(0,0,u,n.startAngle,n.startAngle+n.angle/2,!1),t.arc(0,0,u,n.startAngle+n.angle/2,n.startAngle+n.angle,!1),t.closePath(),t.fill())}var i=n.getOptions(),u=i.series.pie.radius>1?i.series.pie.radius:o*i.series.pie.radius,r;for(t.save(),t.translate(e,c),t.scale(1,i.series.pie.tilt),r=0;r<s.length;++r)f(s[r].series);v(t);t.restore()}var a=null,h=null,o=null,e=null,c=null,l=!1,f=null,s=[];u.hooks.processOptions.push(function(n,t){t.series.pie.show&&(t.grid.show=!1,t.series.pie.label.show=="auto"&&(t.series.pie.label.show=t.legend.show?!1:!0),t.series.pie.radius=="auto"&&(t.series.pie.radius=t.series.pie.label.show?3/4:1),t.series.pie.tilt>1?t.series.pie.tilt=1:t.series.pie.tilt<0&&(t.series.pie.tilt=0))});u.hooks.bindEvents.push(function(n,t){var i=n.getOptions();i.series.pie.show&&(i.grid.hoverable&&t.unbind("mousemove").mousemove(nt),i.grid.clickable&&t.unbind("click").click(tt))});u.hooks.processDatapoints.push(function(n,t,i,r){var u=n.getOptions();u.series.pie.show&&w(n,t,i,r)});u.hooks.drawOverlay.push(function(n,t){var i=n.getOptions();i.series.pie.show&&ut(n,t)});u.hooks.draw.push(function(n,t){var i=n.getOptions();i.series.pie.show&&k(n,t)})}var i=10,r=.95,t={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(n,t){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+t.color+";'>"+n+"<br/>"+Math.round(t.percent)+"%<\/div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};n.plot.plugins.push({init:u,options:t,name:"pie",version:"1.1"})})(jQuery);
/*
//# sourceMappingURL=jquery.flot.pie.min.js.map
*/