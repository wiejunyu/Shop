
@{
    ViewBag.Title = "CMS || 添加菜单";
    Layout = "~/Views/Shared/MainMaster.cshtml";
}
@using JH.Cms.Models
<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
<!-- /.modal -->
<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
<!-- BEGIN STYLE CUSTOMIZER -->
<!-- BEGIN PAGE HEADER-->
<div class="row">
    <div class="col-md-12">
        <!-- BEGIN PAGE TITLE & BREADCRUMB-->
        <ul class="page-breadcrumb breadcrumb">
            <li>
                <i class="fa fa-home"></i>
                <a href="/Home/Index">首页</a>
                <i class="fa fa-angle-right"></i>
            </li>
            <li><a href="/Menu/MenuList">系统管理</a><i class="fa fa-angle-right"></i></li>
            <li class="active">添加菜单</li>
        </ul>
        <!-- END PAGE TITLE & BREADCRUMB-->
    </div>
</div>
<!-- END PAGE HEADER-->
<!-- CONTENT BODY GOES HERE >>>> -->
<!-- END PAGE CONTENT-->

<div class="row">
    <div class="col-md-12">
        <!-- BEGIN PORTLET-->
        <div class="portlet box grey">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-reorder"></i>添加菜单
                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse"></a>
                </div>
            </div>
            <div class="portlet-body form" id="info">
                <!-- BEGIN FORM-->
                <form class="form-horizontal">
                    <div class="form-body">
                        <div class="form-group" id="Titlefrom">
                            <label class="col-md-3 control-label">
                                名称
                            </label>
                            <div class="col-md-4">
                                <input type="text" class="form-control" placeholder="Enter text" name="Name" id="Name">
                                <span class="help-block" id="Title_error">
                                    
                                </span>
                            </div>
                        </div>
                        <div class="form-group" id="Urlfrom">
                            <label class="col-md-3 control-label">
                                Url
                            </label>
                            <div class="col-md-4">
                                <input type="text" class="form-control" placeholder="Enter text" name="Url" id="Url">
                                <span class="help-block" id="Url_error">
                                    格式：/Controllers/Action
                                </span>
                            </div>
                        </div>
                        <div class="form-group" id="Actionfrom">
                            <label class="col-md-3 control-label">
                                标识
                            </label>
                            <div class="col-md-4">
                                <input type="text" class="form-control" placeholder="Enter text" name="Action" id="Action">
                                <span class="help-block" id="Action_error">
                                    
                                </span>
                            </div>
                        </div>
                        <div class="form-group" id="Sortfrom">
                            <label class="col-md-3 control-label">
                                排序
                            </label>
                            <div class="col-md-4">
                                <input type="text" class="form-control" placeholder="Enter text" name="Sort" id="Sort" value="1">
                                <span class="help-block" id="Sort_error">
                                    数字越小越靠前
                                </span>
                            </div>
                        </div>
                        <div class="form-group" id="Lvfrom">
                            <label class="col-md-3 control-label">
                                菜单节点
                            </label>
                            <div class="col-md-4">
                                <div class="radio-list">
                                    <label class="radio-inline">
                                        <input type="radio" name="Lv" id="Lv1" value="0" checked>根节点
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="Lv" id="Lv2" value="1">页面节点
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="Lv" id="Lv3" value="2">功能节点
                                    </label>
                                </div>

                            </div>
                        </div>
                        <div class="form-group" id="Pidfrom">
                            <label class="col-md-3 control-label">
                                上级菜单
                            </label>
                            <div class="col-md-4">
                                <select name="Pid" id="Pid" class="form-control">
                                    <option value='0'>无</option>
                                </select>
                                <span class="help-block" id="Pid_error">
                                    当不是根节点的时候需要选中一个上级菜单
                                </span>
                            </div>
                        </div>
                        <div class="form-group" id="Iconfrom">
                            <label class="col-md-3 control-label">
                                Icon
                            </label>
                            <div class="col-md-4">
                                <input type="text" class="form-control" placeholder="Enter text" name="Icon" id="Icon">
                                <span class="help-block" id="Pid_error">
                                    当属于根菜单的时候需要添加图标
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade" id="basic" tabindex="-1" role="basic" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                                    <h4 class="modal-title">提示</h4>
                                </div>
                                <div class="modal-body" id="resultShow">
                                    
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn default" data-dismiss="modal">关闭</button>
                                </div>
                            </div>
                            <!-- /.modal-content -->
                        </div>
                        <!-- /.modal-dialog -->
                    </div>
                    <div class="form-actions fluid">
                        <div class="col-md-offset-3 col-md-9">
                            <button type="button" class="btn blue" onclick="addMenu()">确定</button>
                            <a id="linkbasic" class="btn default" data-toggle="modal" href="#basic" style="display:none">提示框</a>
                        </div>
                    </div>
                </form>
                <!-- END FORM-->
            </div>
        </div>
        <!-- END PORTLET-->
    </div>
</div>

@*<script src="~/Scripts/js/user.js"></script>*@
<script>
    jQuery(document).ready(function () {
        setClass("MenuList", "MenuList");
        $("#Pid").attr("disabled", true);
        $("input[type='radio']").click(function () {
            var id = $(this).attr("value");
            if (id == 0)
            {
                var str = "<option value='0'>无</option>";
                //$("#MenuID").find("option").eq(0).prop("selected", true);
                $('#Pid').html(str);
                $("#Pid").select2();
                $("#Pid").attr("disabled", true);
                $("#Icon").attr("disabled", false);
            }
            if (id == 1 || id == 2)
            {
                $.ajax({
                    type: "post", //要用post方式   
                    data: "{'lv':'" + id + "'}",
                    url: "/Menu/GetMenu",//方法所在页面和方法名
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        $('#Pid').html(data);
                        $("#Pid").select2();
                    },
                    error: function (err) {
                        alert(err);
                    }
                });
                $("#Pid").attr("disabled", false);
                $("#Icon").attr("disabled", true);
            }
        });
        $("#Pid").select2();
    });

    //添加菜单
    function addMenu() {
        $("#resultShow").html("正在添加菜单,请稍等.");
        $("#linkbasic").click();
        var jsondata = undefined;
        jsondata = $("form", "#info").serializeObject();
        jsondata = { json: JSON.stringify(jsondata) };
        $.ajax({
            type: "post", //要用post方式
            url: "/Menu/AddMenu",//方法所在页面和方法名
            data: jsondata,
            dataType: "json",
            success: function (data) {
                if (data == "1")//返回的数据用data.d获取内容
                {
                    $("#resultShow").html("已经成功添加菜单");
                }
                else {
                    $("#resultShow").html("菜单添加失败");
                }
            },
            error: function (err) {
                alert(err);
            }
        });
    }
</script>


